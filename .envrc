# ==============================================================================
# direnv configuration
# ==============================================================================
# Auto-loads config/secrets.env when you cd into this directory
# Install direnv: https://direnv.net
# Run once: direnv allow
# ==============================================================================

dotenv_if_exists config/secrets.env

# Activate Python venv if it exists
if [ -d .venv ]; then
  source .venv/bin/activate
fi

# Export for Terraform (TF_VAR_ prefix)
export TF_VAR_hcloud_token="${HCLOUD_TOKEN}"

# Read SSH key path from config.yaml if available
if [ -f config/config.yaml ] && command -v python &> /dev/null; then
  SSH_KEY_FILE=$(python -c "import yaml; c=yaml.safe_load(open('config/config.yaml')); import os; print(os.path.expanduser(c['ssh_keys']['hetzner']))" 2>/dev/null)
  if [ -n "$SSH_KEY_FILE" ] && [ -f "${SSH_KEY_FILE}.pub" ]; then
    export TF_VAR_ssh_public_key="$(cat ${SSH_KEY_FILE}.pub)"
  fi
fi